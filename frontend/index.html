<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Economic Advisor - Plataforma Profissional de Investimentos</title>
    <meta name="description" content="Plataforma avan√ßada de an√°lise econ√¥mica e gest√£o de portf√≥lio com IA">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <meta name="theme-color" content="#1FB8CD">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="config.js"></script>
    <script src="gemini-integration.js"></script>
    <script src="market-strategy.js"></script>
    <script src="market-api.js"></script>
    <script src="market-predictions.js"></script>
    <script src="hull-market-prediction.js"></script>
    <script src="i18n.js"></script>
    <script src="language-switcher.js"></script>
</head>
<body>
    <!-- Navigation Header -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <h2>AI Economic Advisor</h2>
            </div>
            <nav class="nav-menu">
                <button class="nav-item active" data-page="dashboard">Dashboard</button>
                <button class="nav-item" data-page="portfolio">Portf√≥lio</button>
                <button class="nav-item" data-page="economic">An√°lise Econ√¥mica</button>
                <button class="nav-item" data-page="risk">Avalia√ß√£o de Risco</button>
                <button class="nav-item" data-page="chat">Chat IA</button>
                <button class="nav-item" data-page="settings">Configura√ß√µes</button>
            </nav>
            <div class="header-controls">
                <button class="theme-toggle" id="themeToggle">üåô</button>
                <div class="market-status">
                    <div class="status-indicator live"></div>
                    <span>Mercado Ativo</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="main-content">
        <!-- Dashboard Page -->
        <div class="page active" id="dashboard">
            <div class="dashboard-grid">
                <!-- Portfolio Summary -->
                <div class="card portfolio-summary">
                    <div class="card-header">
                        <h3>Vis√£o Geral do Portf√≥lio</h3>
                        <div class="portfolio-value">
                            <span class="value">R$ <span id="portfolioValue">300.910,60</span></span>
                            <span class="return positive">+18,87%</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="portfolio-metrics">
                            <div class="metric">
                                <span class="label">√çndice Sharpe</span>
                                <span class="value">0,87</span>
                            </div>
                            <div class="metric">
                                <span class="label">Beta</span>
                                <span class="value">1,15</span>
                            </div>
                            <div class="metric">
                                <span class="label">VaR (95%)</span>
                                <span class="value">2,3%</span>
                            </div>
                        </div>
                        <div class="chart-container" style="position: relative; height: 200px;">
                            <canvas id="portfolioChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Economic Indicators -->
                <div class="card economic-indicators">
                    <div class="card-header">
                        <h3>Indicadores Econ√¥micos Principais</h3>
                        <div class="refresh-btn">üîÑ</div>
                    </div>
                    <div class="card-body">
                        <div class="indicator-grid">
                            <div class="indicator">
                                <div class="indicator-name">Infla√ß√£o Brasil</div>
                                <div class="indicator-value">4,2%</div>
                                <div class="indicator-change">+0,1%</div>
                            </div>
                            <div class="indicator">
                                <div class="indicator-name">Taxa Selic</div>
                                <div class="indicator-value">11,75%</div>
                                <div class="indicator-change">-</div>
                            </div>
                            <div class="indicator">
                                <div class="indicator-name">USD/BRL</div>
                                <div class="indicator-value">5,12</div>
                                <div class="indicator-change">-0,02</div>
                            </div>
                            <div class="indicator">
                                <div class="indicator-name">Pre√ßo do Petr√≥leo</div>
                                <div class="indicator-value">$82,50</div>
                                <div class="indicator-change">+2,1%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Insights -->
                <div class="card ai-insights">
                    <div class="card-header">
                        <h3>Insights de IA do Mercado</h3>
                        <div class="ai-status">ü§ñ Ativo</div>
                    </div>
                    <div class="card-body">
                        <div class="insights-list">
                            <div class="insight">
                                <div class="insight-icon">üìà</div>
                                <div class="insight-text">Setor financeiro mostra forte momentum com ITUB3 liderando em +82,3%</div>
                            </div>
                            <div class="insight">
                                <div class="insight-icon">üõ°Ô∏è</div>
                                <div class="insight-text">Exposi√ß√£o energ√©tica atrav√©s de PETR4 oferece prote√ß√£o efetiva contra infla√ß√£o</div>
                            </div>
                            <div class="insight">
                                <div class="insight-icon">‚ö†Ô∏è</div>
                                <div class="insight-text">Considere diversificar al√©m do mercado brasileiro para redu√ß√£o de risco</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hull Tactical Analysis -->
                <div class="card hull-analysis">
                    <div class="card-header">
                        <h3>üéØ Hull Tactical Analysis</h3>
                        <div class="hull-controls">
                            <button class="btn btn--small btn--primary" id="hullAnalyzeBtn">Analisar</button>
                            <button class="btn btn--small btn--outline" id="hullPredictBtn">Predi√ß√£o</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="hull-status" id="hullStatus">
                            <div class="status-item">
                                <span class="status-label">Sinal de Mercado:</span>
                                <span class="status-value" id="hullSignal">Carregando...</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Confian√ßa:</span>
                                <span class="status-value" id="hullConfidence">-</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Recomenda√ß√£o:</span>
                                <span class="status-value" id="hullRecommendation">-</span>
                            </div>
                        </div>
                        <div class="hull-predictions" id="hullPredictions">
                            <div class="prediction-placeholder">
                                Clique em "Analisar" para obter predi√ß√µes Hull Tactical
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Market Data -->
                <div class="card market-data">
                    <div class="card-header">
                        <h3>Dados de Mercado em Tempo Real</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="position: relative; height: 250px;">
                            <canvas id="marketChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Portfolio Page -->
        <div class="page" id="portfolio">
            <div class="portfolio-container">
                <div class="portfolio-header">
                    <h2>Gest√£o de Portf√≥lio</h2>
                    <div class="portfolio-controls">
                        <button class="btn btn--primary" id="optimizeBtn">ü§ñ Otimizar IA</button>
                        <button class="btn btn--outline" id="rebalanceBtn">‚öñÔ∏è Rebalancear</button>
                        <button class="btn btn--outline" id="exportBtn">üìä Exportar Relat√≥rio</button>
                    </div>
                </div>
                
                <div class="portfolio-grid">
                    <!-- Holdings Table -->
                    <div class="card holdings-card">
                        <div class="card-header">
                            <h3>Posi√ß√µes Atuais</h3>
                        </div>
                        <div class="card-body">
                            <div class="holdings-table">
                                <div class="table-header">
                                    <div class="col-symbol">S√≠mbolo</div>
                                    <div class="col-qty">Quantidade</div>
                                    <div class="col-price">Pre√ßo</div>
                                    <div class="col-value">Valor</div>
                                    <div class="col-return">Retorno</div>
                                </div>
                                <div class="table-body" id="holdingsTable">
                                    <!-- Holdings will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Allocation Chart -->
                    <div class="card allocation-card">
                        <div class="card-header">
                            <h3>Aloca√ß√£o de Ativos</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="allocationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Economic Analysis Page -->
        <div class="page" id="economic">
            <div class="economic-container">
                <h2>An√°lise Econ√¥mica</h2>
                <div class="economic-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Tend√™ncias Econ√¥micas Globais</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="economicChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Calend√°rio Econ√¥mico</h3>
                        </div>
                        <div class="card-body">
                            <div class="calendar-events">
                                <div class="event">
                                    <div class="event-date">18 Set</div>
                                    <div class="event-title">Reuni√£o do Federal Reserve</div>
                                    <div class="event-impact high">Alto Impacto</div>
                                </div>
                                <div class="event">
                                    <div class="event-date">20 Set</div>
                                    <div class="event-title">Divulga√ß√£o PIB Brasil</div>
                                    <div class="event-impact medium">M√©dio Impacto</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Assessment Page -->
        <div class="page" id="risk">
            <div class="risk-container">
                <h2>Avalia√ß√£o de Risco</h2>
                <div class="risk-grid">
                    <div class="card risk-metrics">
                        <div class="card-header">
                            <h3>M√©tricas de Risco</h3>
                        </div>
                        <div class="card-body">
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <div class="metric-label">Value at Risk (95%)</div>
                                    <div class="metric-value">2,3%</div>
                                    <div class="metric-desc">Potencial de perda di√°ria</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Drawdown M√°ximo</div>
                                    <div class="metric-value">-8,9%</div>
                                    <div class="metric-desc">Pior performance do per√≠odo</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">√çndice Sortino</div>
                                    <div class="metric-value">1,23</div>
                                    <div class="metric-desc">Retorno ajustado ao risco negativo</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card correlation-matrix">
                        <div class="card-header">
                            <h3>Matriz de Correla√ß√£o</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="position: relative; height: 300px;">
                                <canvas id="correlationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Chat Page -->
        <div class="page" id="chat">
            <div class="chat-container">
                <div class="chat-header">
                    <h2>ü§ñ Consultor de Investimentos IA</h2>
                    <div class="ai-status-indicator">
                        <div class="status-dot"></div>
                        <span>Online</span>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai-message">
                        <div class="message-content">
                            <div class="message-avatar">ü§ñ</div>
                            <div class="message-text">
                                Ol√°! Sou seu Consultor Econ√¥mico IA. Posso ajudar voc√™ a analisar seu portf√≥lio, entender as condi√ß√µes do mercado e fornecer recomenda√ß√µes de investimento. O que gostaria de saber?
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="Pergunte sobre mercados, otimiza√ß√£o de portf√≥lio ou tend√™ncias econ√¥micas...">
                        <button class="send-btn" id="sendBtn">Enviar</button>
                    </div>
                    <div class="quick-questions">
                        <button class="quick-btn" data-question="Qual √© a perspectiva para os mercados brasileiros?">üáßüá∑ Perspectiva Brasil</button>
                        <button class="quick-btn" data-question="Como devo me proteger contra a infla√ß√£o?">üõ°Ô∏è Prote√ß√£o Infla√ß√£o</button>
                        <button class="quick-btn" data-question="Otimize meu portf√≥lio para prote√ß√£o contra recess√£o">üìâ Estrat√©gia Recess√£o</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div class="page" id="settings">
            <div class="settings-container">
                <h2>Configura√ß√µes</h2>
                <div class="settings-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Toler√¢ncia ao Risco</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">Horizonte de Investimento</label>
                                <select class="form-control" id="investmentHorizon">
                                    <option value="short">Curto Prazo (1-3 anos)</option>
                                    <option value="medium" selected>M√©dio Prazo (3-7 anos)</option>
                                    <option value="long">Longo Prazo (7+ anos)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">N√≠vel de Risco: <span id="riskLevelValue">Moderado</span></label>
                                <input type="range" id="riskLevel" min="1" max="5" value="3" class="risk-slider">
                                <div class="risk-labels">
                                    <span>Conservador</span>
                                    <span>Agressivo</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Notifica√ß√µes</h3>
                        </div>
                        <div class="card-body">
                            <div class="notification-settings">
                                <div class="setting-item">
                                    <label>Alertas de portf√≥lio</label>
                                    <input type="checkbox" checked>
                                </div>
                                <div class="setting-item">
                                    <label>Atualiza√ß√µes econ√¥micas</label>
                                    <input type="checkbox" checked>
                                </div>
                                <div class="setting-item">
                                    <label>Recomenda√ß√µes IA</label>
                                    <input type="checkbox" checked>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processando sua solicita√ß√£o...</div>
    </div>

    <script src="banking-integration.js"></script>
    <script src="app.js"></script>
    <!-- Mode Detection and Authentication -->
    <script>
        // Mode Detection System
        class AppModeManager {
            constructor() {
                this.mode = this.detectMode();
                this.bankingService = new BankingService();
                this.init();
            }

            detectMode() {
                const urlParams = new URLSearchParams(window.location.search);
                const isBankingMode = urlParams.get('banking') === 'true';
                const isDemoMode = urlParams.get('demo') === 'true';
                
                if (isBankingMode && this.bankingService.isAuthenticated()) {
                    return 'banking';
                } else if (isDemoMode) {
                    return 'demo';
                } else {
                    return 'normal';
                }
            }

            init() {
                console.log(`üöÄ AI Economic Advisor initialized in ${this.mode} mode`);
                
                // Add mode indicator to header
                this.addModeIndicator();
                
                // Add authentication controls if needed
                if (this.mode === 'banking') {
                    this.initBankingMode();
                } else if (this.mode === 'demo') {
                    this.loadDemoFeatures();
                } else {
                    this.initNormalMode();
                }
            }

            addModeIndicator() {
                const headerControls = document.querySelector('.header-controls');
                if (headerControls) {
                    const modeIndicator = document.createElement('div');
                    modeIndicator.className = 'mode-indicator';
                    
                    if (this.mode === 'banking') {
                        modeIndicator.innerHTML = `
                            <div class="banking-mode">
                                <span class="mode-icon">üè¶</span>
                                <span class="mode-text">Banking Mode</span>
                                <button class="logout-btn" onclick="appModeManager.logout()">Sair</button>
                            </div>
                        `;
                    } else if (this.mode === 'demo') {
                        modeIndicator.innerHTML = `
                            <div class="demo-mode">
                                <span class="mode-icon">üéÆ</span>
                                <span class="mode-text">Demo Mode</span>
                            </div>
                        `;
                    } else {
                        modeIndicator.innerHTML = `
                            <div class="normal-mode">
                                <button class="login-btn" onclick="appModeManager.goToLogin()">üè¶ Login Banc√°rio</button>
                            </div>
                        `;
                    }
                    
                    headerControls.insertBefore(modeIndicator, headerControls.firstChild);
                }
            }

            initBankingMode() {
                console.log('üè¶ Initializing Banking Mode...');
                
                // Add banking balance to portfolio
                this.addBankingBalance();
                
                // Enable real investment features
                this.enableRealInvestments();
                
                // Load banking transaction history
                this.loadBankingHistory();
            }

            initNormalMode() {
                console.log('üìä Initializing Normal Mode - Full AI Economic Advisor');
                
                // Enable all original features
                this.enableOriginalFeatures();
            }

            loadDemoFeatures() {
                console.log('üéÆ Loading Demo Features...');
                
                // Dynamically load demo features
                const script = document.createElement('script');
                script.src = 'demo-features.js';
                document.head.appendChild(script);
            }

            async addBankingBalance() {
                try {
                    const balance = await this.bankingService.getBalance();
                    const portfolioSummary = document.querySelector('.portfolio-summary .card-header');
                    
                    if (portfolioSummary) {
                        const bankingBalance = document.createElement('div');
                        bankingBalance.className = 'banking-balance';
                        bankingBalance.innerHTML = `
                            <div class="balance-info">
                                <span class="balance-label">Saldo Banc√°rio:</span>
                                <span class="balance-value">R$ ${balance.balance.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                            </div>
                        `;
                        portfolioSummary.appendChild(bankingBalance);
                    }
                } catch (error) {
                    console.error('Error loading banking balance:', error);
                }
            }

            enableRealInvestments() {
                console.log('üí∞ Enabling real investment features...');
                
                // This will be implemented in subsequent tasks
                // For now, just add visual indicators
                const investmentButtons = document.querySelectorAll('.investment-btn, .buy-btn, .sell-btn');
                investmentButtons.forEach(btn => {
                    btn.classList.add('real-investment');
                    btn.title = 'Investimento real - ser√° debitado do seu saldo banc√°rio';
                });
            }

            enableOriginalFeatures() {
                console.log('‚ú® All original AI Economic Advisor features enabled');
                
                // Ensure all original functionality is available
                // This preserves the beautiful UI and Google API integration
            }

            async loadBankingHistory() {
                try {
                    const history = await this.bankingService.getTransactionHistory();
                    console.log('üìä Banking transaction history loaded:', history.length, 'transactions');
                } catch (error) {
                    console.error('Error loading banking history:', error);
                }
            }

            goToLogin() {
                window.location.href = 'banking-login.html';
            }

            logout() {
                this.bankingService.logout();
                window.location.href = 'index.html';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.appModeManager = new AppModeManager();
        });
    </script>
    
    <!-- Mode-specific styles -->
    <style>
        .mode-indicator {
            margin-right: 15px;
        }

        .banking-mode, .demo-mode, .normal-mode {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-icon {
            font-size: 16px;
        }

        .mode-text {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .login-btn, .logout-btn {
            padding: 6px 12px;
            border: 1px solid var(--color-primary);
            background: transparent;
            color: var(--color-primary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .login-btn:hover, .logout-btn:hover {
            background: var(--color-primary);
            color: white;
        }

        .banking-balance {
            margin-top: 10px;
            padding: 10px;
            background: var(--color-success);
            border-radius: 6px;
            color: white;
        }

        .balance-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .balance-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .balance-value {
            font-weight: bold;
            font-size: 14px;
        }

        .real-investment {
            position: relative;
        }

        .real-investment::after {
            content: 'üí∞';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 12px;
        }

        /* Hull Tactical Analysis Styles */
        .hull-analysis .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hull-controls {
            display: flex;
            gap: 8px;
        }

        .btn--small {
            padding: 4px 8px;
            font-size: 12px;
        }

        .hull-status {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .status-item {
            text-align: center;
            padding: 10px;
            background: var(--color-background);
            border-radius: 6px;
        }

        .status-label {
            display: block;
            font-size: 11px;
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }

        .status-value {
            display: block;
            font-weight: bold;
            font-size: 14px;
        }

        .hull-predictions {
            min-height: 60px;
            padding: 10px;
            background: var(--color-background);
            border-radius: 6px;
            border-left: 3px solid var(--color-primary);
        }

        .prediction-placeholder {
            color: var(--color-text-secondary);
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        .prediction-item {
            margin-bottom: 8px;
            padding: 8px;
            background: var(--color-surface);
            border-radius: 4px;
            font-size: 13px;
        }

        .prediction-symbol {
            font-weight: bold;
            color: var(--color-primary);
        }

        .prediction-action {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 8px;
        }

        .action-buy { background: var(--color-success); color: white; }
        .action-sell { background: var(--color-error); color: white; }
        .action-hold { background: var(--color-warning); color: white; }
    </style>
</body>
</html>